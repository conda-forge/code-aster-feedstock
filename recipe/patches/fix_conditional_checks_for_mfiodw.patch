Subject: [PATCH] fix: add conditional checks for mfiodw integration with MED library
---
Index: bibfor/echange/as_mfiodw_field.F90
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/bibfor/echange/as_mfiodw_field.F90 b/bibfor/echange/as_mfiodw_field.F90
--- a/bibfor/echange/as_mfiodw_field.F90	(revision cc6de455fc53965a129fffed077e68b12b1f4209)
+++ b/bibfor/echange/as_mfiodw_field.F90	(date 1768937033425)
@@ -46,7 +46,11 @@
         ! On verifie que le champ existe bien avant d'appeler mfiodw
         call mfioex(fidm, class4, cha, oexist4, cret4)
         if (oexist4 .eq. 1) then
+#ifdef ASTER_HAVE_MED_MFIODW
             call mfiodw(fidm, class4, cha, desc, cret4)
+#else
+            cret4 = 0
+#endif
             cret = cret4
         else
             cret = -1
@@ -66,7 +70,11 @@
         ! On verifie que le champ existe bien avant d'appeler mfiodw
         call mfioex(fid, class, cha, oexist, cret)
         if (oexist .eq. 1) then
+#ifdef ASTER_HAVE_MED_MFIODW
             call mfiodw(fid, class, cha, desc, cret)
+#else
+            cret = 0
+#endif
         else
             cret = -1
         end if
Index: waftools/med_cfg.py
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/waftools/med_cfg.py b/waftools/med_cfg.py
--- a/waftools/med_cfg.py	(revision cc6de455fc53965a129fffed077e68b12b1f4209)
+++ b/waftools/med_cfg.py	(date 1768937046874)
@@ -239,6 +239,38 @@
     self.check_sizeof_med_int()
     self.check_sizeof_med_idt()
     self.check_med_python()
+    self.check_mfiodw()
+
+
+@Configure.conf
+def check_mfiodw(self):
+    fragment = r"""
+#include <med.h>
+#ifdef __cplusplus
+extern "C" {
+#endif
+extern void mfiodw(void);
+#ifdef __cplusplus
+}
+#endif
+int main(void){
+    void *p = (void *)mfiodw;
+    return 0;
+}"""
+    self.start_msg("Checking for mfiodw")
+    try:
+        self.check_cc(
+            fragment=fragment,
+            use="MED HDF5 Z",
+            uselib_store="MED",
+            mandatory=False,
+            execute=False,
+        )
+    except:
+        self.end_msg("no", "YELLOW")
+    else:
+        self.define("ASTER_HAVE_MED_MFIODW", 1)
+        self.end_msg("yes")
 
 
 @Configure.conf
Index: bibfor/include/med/mfiodw.h
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
diff --git a/bibfor/include/med/mfiodw.h b/bibfor/include/med/mfiodw.h
--- a/bibfor/include/med/mfiodw.h	(revision cc6de455fc53965a129fffed077e68b12b1f4209)
+++ b/bibfor/include/med/mfiodw.h	(date 1768937019026)
@@ -18,6 +18,7 @@
 
 !
 !
+#ifdef ASTER_HAVE_MED_MFIODW
 interface
 #include "asterf_types.h"
     subroutine mfiodw(fid, class, oname, desc, cret)
@@ -28,3 +29,4 @@
         med_int :: cret
     end subroutine mfiodw
 end interface
+#endif
